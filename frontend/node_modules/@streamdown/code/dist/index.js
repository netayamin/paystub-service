import {bundledLanguages,createHighlighter}from'shiki';var p=new Set(Object.keys(bundledLanguages)),a=new Map,h=new Map,l=new Map,H=(e,t)=>`${e}-${t[0]}-${t[1]}`,k=(e,t,n)=>{let g=e.slice(0,100),i=e.length>100?e.slice(-100):"";return `${t}:${n[0]}:${n[1]}:${e.length}:${g}:${i}`},b=(e,t)=>{let n=H(e,t);if(a.has(n))return a.get(n);let g=createHighlighter({themes:t,langs:[e]});return a.set(n,g),g};function f(e={}){var n;let t=(n=e.themes)!=null?n:["github-light","github-dark"];return {name:"shiki",type:"code-highlighter",supportsLanguage(g){return p.has(g)},getSupportedLanguages(){return Array.from(p)},getThemes(){return t},highlight({code:g,language:i,themes:r},d){let s=k(g,i,r);return h.has(s)?h.get(s):(d&&(l.has(s)||l.set(s,new Set),l.get(s).add(d)),b(i,r).then(u=>{let B=u.getLoadedLanguages().includes(i)?i:"text",o=u.codeToTokens(g,{lang:B,themes:{light:r[0],dark:r[1]}});h.set(s,o);let c=l.get(s);if(c){for(let L of c)L(o);l.delete(s);}}).catch(u=>{console.error("[Streamdown Code] Failed to highlight code:",u),l.delete(s);}),null)}}}var R=f();export{R as code,f as createCodePlugin};