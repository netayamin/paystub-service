# Production: backend only. Postgres must be external (e.g. AWS RDS).
# Do NOT run Postgres in Docker on a micro instance â€” use RDS or another managed DB.
#
# 1. Set backend/.env with DATABASE_URL (your RDS URL), OPENAI_API_KEY, RESY_*, etc.
# 2. Run: docker compose -f docker-compose.prod.yml up -d
# 3. Migrations (once): docker compose -f docker-compose.prod.yml run --rm backend alembic upgrade head

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      args:
        GIT_SHA: ${GIT_SHA:-unknown}
    env_file: ./backend/.env
    # DATABASE_URL comes from backend/.env (e.g. postgresql://user:pass@your-rds.region.rds.amazonaws.com:5432/paystub)
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000"
    restart: unless-stopped
